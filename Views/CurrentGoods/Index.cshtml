@model IEnumerable<WebForm.Models.CurrentGood>

@{
    ViewBag.Title = "Product list";
}

<head>
    <link href="@Url.Content("~/Content/Aternative.css")" rel="stylesheet" type="text/css" />
</head>

<main aria-labelledby="title">
    <p></p>
    <h3 id="title">@ViewBag.Title | <small class="smallsize">@ViewBag.Message</small></h3>    <p></p>
    <p><a class="" href="@Url.Action("Index", "Carts")">Go to your cart&raquo;</a></p>
    <table class="table">
        <tr>
            <th>
                Product Name
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Quantity)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Price)
            </th>
            <th>

            </th>
        </tr>

        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.goodName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Quantity)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Price)
                </td>
                <td>
                    <input type="number" value=1 id="quantity_@item.goodID" name="quantity_@item.goodID" min="1" max="@item.Quantity">
                </td>
                <td align="center">
                    @*<a class="btn btn-outline-cyan"
                           id="@item.goodID" href="@Url.Action("Add", "Carts", new { id = item.goodID, quantity = 1 })">
                            Add to cart
                        </a>*@
                    <button class="btn btn-outline-cyan" id="@item.goodID" href="" onclick="addToCart('@item.goodID', 1)">
                        Add to cart
                    </button>
                </td>

            </tr>
            <script>
                document.addEventListener("DOMContentLoaded", function() {
                var quantityInput = document.getElementById("quantity_@item.goodID");
                if (quantityInput.value === null) {
                    quantityInput.value = 1;
                }
                quantityInput.addEventListener("change", function() {
                    changeNumber("@item.goodID");
                    });
                });

            </script>

        }
    </table>

    <script>
        function changeNumber(goodID) {
            var x = "quantity_" + goodID + "";
            var productQuantity = document.getElementById("quantity_" + goodID + "").value;
            var addToCartButton = document.getElementById(goodID);

            var currentOnclick = addToCartButton.getAttribute("onclick");
            var updatedOC = currentOnclick.substring(0, currentOnclick.indexOf(goodID) + 6) + "," + productQuantity+")";
            alert(updatedOC);
            addToCartButton.setAttribute("onclick", updatedOC);
        }

        // call on change event to update the button or a tag's' href which then change the view when clicked
        //function myFunction(goodID) {
        //    var x = "quantity_" + goodID + "";
        //    var productQuantity = document.getElementById("quantity_" + goodID + "").value;
        //    var addToCartButton = document.getElementById(goodID);

        //    var currentHref = addToCartButton.getAttribute("href");
        //    var updatedHref = currentHref.substring(0, currentHref.indexOf(goodID) + 5) + "?quantity=" + productQuantity;
        //    alert(updatedHref);
        //    addToCartButton.setAttribute("href", updatedHref);
        //}

        //call to not change the view and run in the background
        function addToCart(id, quantity) {
            url = "@Url.Action("Add", "Carts")/" + id + "?quantity=" + quantity;
            $.ajax({
                url: url,
                type: "POST",
                success: function(result) {
                console.log(result);
                },
                error: function(xhr, status, error) {
                console.log(xhr.responseText);
                }
            });
        }
    </script>
</main>